from __future__ import annotations

INPUT = """#############################################################################################################################################
#...#.......#.....#.......#.....###.......#...###...............###...#...#...#...........#.........###...#.......#.....#.....#.....#...#...#
#.#.#.#####.#.###.#.#####.#.###.###.#####.#.#.###.#############.###.#.#.#.#.#.#.#########.#.#######.###.#.#.#####.#.###.#.###.#.###.#.#.#.#.#
#.#.#.....#...#...#...#...#...#...#.....#...#...#.............#...#.#.#.#...#.#...#.......#...#.....#...#...#.....#...#.#.#...#...#.#.#.#.#.#
#.#.#####.#####.#####.#.#####.###.#####.#######.#############.###.#.#.#.#####.###.#.#########.#.#####.#######.#######.#.#.#.#####.#.#.#.#.#.#
#.#.#...#.....#...#...#.....#.#...#...#...#.....#...#...#.....#...#.#.#...#...#...#.....#.....#.....#.......#.#...###.#...#...#...#.#.#...#.#
#.#.#.#.#####.###.#.#######.#.#.###.#.###.#.#####.#.#.#.#.#####.###.#.###.#.###.#######.#.#########.#######.#.#.#.###.#######.#.###.#.#####.#
#.#.#.#.#...#...#.#...#.....#.#...#.#.#...#...#...#...#.#...#...#...#...#.#...#...#.....#.........#.#...#...#.#.#...#.#.......#...#.#.#...#.#
#.#.#.#.#.#.###.#.###.#.#####.###.#.#.#.#####.#.#######.###.#.###.#####.#.###.###.#.#############.#.#.#.#.###.#.###.#.#.#########.#.#.#.#.#.#
#.#...#.#.#.#...#.....#...###.#...#.#.#.#.....#.....#...#...#.....#.....#...#.#...#.#...###.....#.#...#.#...#.#.#...#.#...#...#...#.#.#.#...#
#.#####.#.#.#.###########.###.#.###.#.#.#.#########.#.###.#########.#######.#.#.###.#.#.###.###.#.#####.###.#.#.#.###.###.#.#.#.###.#.#.#####
#.....#.#.#.#...........#...#.#.....#.#.#...#...#...#.#...#.....#...###...#.#.#...#...#...#...#.#...#...#...#.#.#...#.#...#.#.#.#...#.#.....#
#####.#.#.#.###########.###.#.#######.#.###.#.#.#.###.#.###.###.#.#####.#.#.#.###.#######.###.#.###.#.###.###.#.###.#.#.###.#.#.#.###.#####.#
#.....#...#...###...#...#...#...#.....#...#.#.#.#...#...#...###...#...#.#.#.#.#...#.......#...#.#...#...#.#...#...#...#...#.#.#.#.....#...#.#
#.###########.###.#.#.###.#####.#.#######.#.#.#.###.#####.#########.#.#.#.#.#.#.###.#######.###.#.#####.#.#.#####.#######.#.#.#.#######.#.#.#
#.......#...#...#.#.#...#.......#.#...#...#.#.#...#...#...###...#...#...#.#.#.#...#.#.....#...#.#.....#.#.#.###...#.......#.#.#.#.......#...#
#######.#.#.###.#.#.###.#########.#.#.#.###.#.###.###.#.#####.#.#.#######.#.#.###.#.#.###.###.#.#####.#.#.#.###.###.#######.#.#.#.###########
#.....#...#...#.#.#...#.........#...#...#...#.#...###.#.....#.#.#...#...#...#...#.#.#.#...#...#...#...#...#...#...#.#.......#...#.#...#...###
#.###.#######.#.#.###.#########.#########.###.#.#####.#####.#.#.###.#.#.#######.#.#.#.#.###.#####.#.#########.###.#.#.###########.#.#.#.#.###
#.#...#.....#.#.#...#.#...###...#...#...#.#...#.......#.....#.#...#...#.#.....#.#.#.#.#.....#.....#.....#...#.###.#.#.#...........#.#.#.#...#
#.#.###.###.#.#.###.#.#.#.###.###.#.#.#.#.#.###########.#####.###.#####.#.###.#.#.#.#.#######.#########.#.#.#.###.#.#.#.###########.#.#.###.#
#.#...#...#.#.#.....#...#...#...#.#...#...#.#.........#...###.#...#...#...#...#...#.#.......#.###.....#.#.#...#...#...#.....###.....#...#...#
#.###.###.#.#.#############.###.#.#########.#.#######.###.###.#.###.#.#####.#######.#######.#.###.###.#.#.#####.###########.###.#########.###
#.#...#...#...#...........#.#...#...###...#...###...#.#...#...#...#.#.......#.......###.....#...#...#.#.#...#...#...........#...#...#.....###
#.#.###.#######.#########.#.#.#####.###.#.#######.#.#.#.###.#####.#.#########.#########.#######.###.#.#.###.#.###.###########.###.#.#.#######
#.#...#...#...#.#.........#...#...#...#.#.###...#.#.#.#.#...#.....#.........#.#...#...#...#.....#...#.#.#...#...#.#.....###...#...#...###...#
#.###.###.#.#.#.#.#############.#.###.#.#.###.#.#.#.#.#.#.###.#############.#.#.#.#.#.###.#.#####.###.#.#.#####.#.#.###.###.###.#########.#.#
#...#.###.#.#...#...#...#.....#.#...#...#.#...#.#.#...#.#.#...#...#...#.....#.#.#.#.#.###.#...###...#...#.......#...#...#...#...###.....#.#.#
###.#.###.#.#######.#.#.#.###.#.###.#####.#.###.#.#####.#.#.###.#.#.#.#.#####.#.#.#.#.###.###.#####.#################.###.###.#####.###.#.#.#
#...#...#...#.....#...#...#...#.#...#.....#.#...#...#...#.#.###.#.#.#.#.....#.#.#.#.#...#.#...#...#.#.....#.....#.....#...#...#...#.#...#.#.#
#.#####.#####.###.#########.###.#.###.#####.#.#####.#.###.#.###.#.#.#.#####.#.#.#.#.###.#.#.###.#.#.#.###.#.###.#.#####.###.###.#.#.#.###.#.#
#.#...#.....#...#.......###.....#...#...#...#...#...#...#.#...#.#.#.#.#.....#.#.#...#...#.#...#.#.#.#...#...###...#.....#...#...#...#.....#.#
#.#.#.#####.###.#######.###########.###.#.#####.#.#####.#.###.#.#.#.#.#.#####.#.#####.###.###.#.#.#.###.###########.#####.###.#############.#
#.#.#...#...###.....#...#.....#...#...#.#...#...#...#...#.#...#.#.#.#.#...#...#...#...###...#.#.#.#...#.#.....#...#.#.....###.#.............#
#.#.###.#.#########.#.###.###.#.#.###.#.###.#.#####.#.###.#.###.#.#.#.###.#.#####.#.#######.#.#.#.###.#.#.###.#.#.#.#.#######.#.#############
#.#...#.#...#...#...#.###...#.#.#.#...#...#.#...#...#...#.#...#.#.#.#.....#.#...#.#.#...#...#.#.#.#...#...#...#.#.#.#.###.....#.......###...#
#.###.#.###.#.#.#.###.#####.#.#.#.#.#####.#.###.#.#####.#.###.#.#.#.#######.#.#.#.#.#.#.#.###.#.#.#.#######.###.#.#.#.###.###########.###.#.#
#.....#...#...#...#...#...#.#.#.#...#...#.#.#...#...#...#...#...#.#.....###.#.#...#...#.#.#...#.#.#.#...#...###.#.#.#.....#...........#...#.#
#########.#########.###.#.#.#.#.#####.#.#.#.#.#####.#.#####.#####.#####.###.#.#########.#.#.###.#.#.#.#.#.#####.#.#.#######.###########.###.#
#.........#...#...#.....#...#...#.....#.#...#.....#.#.#...#.#.....#...#.#...#.#.......#...#...#.#...#.#...#...#.#.#.#.......###.........#...#
#.#########.#.#.#.###############.#####.#########.#.#.#.#.#.#.#####.#.#.#.###.#.#####.#######.#.#####.#####.#.#.#.#.#.#########.#########.###
#.........#.#.#.#...#...#...#...#.#.....#...###...#.#.#.#.#.#.#...#.#.#.#...#...#...#...#.....#.###...#...#.#...#...#.#...#...#.#.......#...#
#########.#.#.#.###.#.#.#.#.#.#.#.#.#####.#.###.###.#.#.#.#.#.#.#.#.#.#.###.#####.#.###.#.#####.###.###.#.#.#########.#.#.#.#.#.#.#####.###.#
#.........#.#...###.#.#.#.#.#.#...#.......#.#...#...#.#.#...#.#.#...#.#.###...#...#.#...#.#...#...#...#.#...#.......#...#...#...#.....#.#...#
#.#########.#######.#.#.#.#.#.#############.#.###.###.#.#####.#.#####.#.#####.#.###.#.###.#.#.###.###.#.#####.#####.#################.#.#.###
#...#.....#.#.....#.#.#...#...#.........#...#.#...#...#.....#.#...#...#...###.#...#.#...#.#.#...#...#...#...#.....#...........#...#...#.#...#
###.#.###.#.#.###.#.#.#########.#######.#.###.#.###.#######.#.###.#.#####.###.###.#.###.#.#.###.###.#####.#.#####.###########.#.#.#.###.###.#
#...#.###.#.#...#...#.....#...#.......#.#...#...###.....#...#.#...#.....#.#...#...#.....#.#...#...#.#.....#.......#.......#...#.#...###...#.#
#.###.###.#.###.#########.#.#.#######.#.###.###########.#.###.#.#######.#.#.###.#########.###.###.#.#.#############.#####.#.###.#########.#.#
#...#.#...#...#.....#.....#.#.#...#...#.....#.......#...#...#.#.....###.#.#...#.......###.#...###.#.#.#.............#.....#.....#.......#...#
###.#.#.#####.#####.#.#####.#.#.#.#.#########.#####.#.#####.#.#####.###.#.###.#######.###.#.#####.#.#.#.#############.###########.#####.#####
#...#.#.#.....###...#.#.....#...#.#...#.......#...#.#.......#...#...#...#.#...#.....#...#...#...#.#.#...#...#.........###.....#...#.....#...#
#.###.#.#.#######.###.#.#########.###.#.#######.#.#.###########.#.###.###.#.###.###.###.#####.#.#.#.#####.#.#.###########.###.#.###.#####.#.#
#.....#...#.......#...#.........#.....#.......#.#...#.........#...###.#...#...#...#.#...#####.#...#.#.....#...#.....#...#.#...#.#...#.....#.#
###########.#######.###########.#############.#.#####.#######.#######.#.#####.###.#.#.#######.#####.#.#########.###.#.#.#.#.###.#.###.#####.#
#...###...#.......#.#...........#.......###...#...#...#.....#...#...#...#...#...#.#...#######.......#...........#...#.#.#.#.....#.....#.....#
#.#.###.#.#######.#.#.###########.#####.###.#####.#.###.###.###.#.#.#####.#.###.#.###############################.###.#.#.#############.#####
#.#...#.#.#.......#.#.......#...#.#.....#...#...#...#...###...#...#.....#.#.....#.###############################.....#...#...........#.....#
#.###.#.#.#.#######.#######.#.#.#.#.#####.###.#.#####.#######.#########.#.#######.#########################################.#########.#####.#
#...#.#.#.#.....#...#.....#...#...#.......#...#.......###...#...#.....#.#...#...#.#####################...#...#####E#.....#.........#.......#
###.#.#.#.#####.#.###.###.#################.#############.#.###.#.###.#.###.#.#.#.#####################.#.#.#.#####.#.###.#########.#########
#...#.#.#...###...###...#.#...............#.........#...#.#.###...#...#.#...#.#.#...#################...#...#.....#.#...#.#...#.....###...###
#.###.#.###.###########.#.#.#############.#########.#.#.#.#.#######.###.#.###.#.###.#################.###########.#.###.#.#.#.#.#######.#.###
#...#.#.#...#...#...#...#.#.#.......#...#...#.....#...#...#.......#...#.#...#.#...#.#......S#########...#.....#...#.#...#...#...###...#.#...#
###.#.#.#.###.#.#.#.#.###.#.#.#####.#.#.###.#.###.###############.###.#.###.#.###.#.#.#################.#.###.#.###.#.#############.#.#.###.#
#...#...#...#.#.#.#.#.#...#...#...#...#...#.#...#.#...#...#...#...###.#.###...###...#...#...#...#...#...#...#...###...#.......#...#.#.#.#...#
#.#########.#.#.#.#.#.#.#######.#.#######.#.###.#.#.#.#.#.#.#.#.#####.#.###############.#.#.#.#.#.#.#.#####.###########.#####.#.#.#.#.#.#.###
#...#.....#...#...#...#.....#...#.......#.#...#.#.#.#.#.#.#.#.#.....#...#.....#...#...#...#...#.#.#.#.#.....#...#...###.....#.#.#.#.#...#.###
###.#.###.#################.#.#########.#.###.#.#.#.#.#.#.#.#.#####.#####.###.#.#.#.#.#########.#.#.#.#.#####.#.#.#.#######.#.#.#.#.#####.###
###...###.#.............#...#.........#.#...#...#...#...#...#.......#...#...#.#.#.#.#.......###...#...#.....#.#.#.#.#...#...#...#...#...#...#
#########.#.###########.#.###########.#.###.#########################.#.###.#.#.#.#.#######.###############.#.#.#.#.#.#.#.###########.#.###.#
#.........#.#...........#...#.....#...#...#.........#...........#.....#.#...#.#.#.#.....#...#.....#.........#.#.#.#.#.#.#.#.....#...#.#.....#
#.#########.#.#############.#.###.#.#####.#########.#.#########.#.#####.#.###.#.#.#####.#.###.###.#.#########.#.#.#.#.#.#.#.###.#.#.#.#######
#.#...#...#.#...........#...#...#...#...#...........#.#.........#.....#.#...#.#.#...###.#...#...#.#...........#...#...#...#...#.#.#.#.......#
#.#.#.#.#.#.###########.#.#####.#####.#.#############.#.#############.#.###.#.#.###.###.###.###.#.###########################.#.#.#.#######.#
#...#...#...###...#.....#.....#.......#.....#...#...#.#.....#.....#...#...#.#.#.#...#...#...#...#...#...#.....#...#...#.......#.#.#.#.....#.#
###############.#.#.#########.#############.#.#.#.#.#.#####.#.###.#.#####.#.#.#.#.###.###.###.#####.#.#.#.###.#.#.#.#.#.#######.#.#.#.###.#.#
#...............#.#.....#...#.#...#.........#.#...#.#.#.....#...#...#...#...#...#...#.#...###.....#...#...###...#...#.#.......#.#.#.#...#.#.#
#.###############.#####.#.#.#.#.#.#.#########.#####.#.#.#######.#####.#.###########.#.#.#########.###################.#######.#.#.#.###.#.#.#
#.#.............#.....#...#.#...#...#.....###.#.....#.#.......#.......#...#...#...#.#.#.#...#...#.....#...........#...#...#...#...#.#...#...#
#.#.###########.#####.#####.#########.###.###.#.#####.#######.###########.#.#.#.#.#.#.#.#.#.#.#.#####.#.#########.#.###.#.#.#######.#.#######
#...#...........#...#.......#.........#...#...#.......#.......#...#.....#...#...#.#.#.#.#.#.#.#.#...#...#...#.....#.....#...###...#...###...#
#####.###########.#.#########.#########.###.###########.#######.#.#.###.#########.#.#.#.#.#.#.#.#.#.#####.#.#.#################.#.#######.#.#
#...#.............#.........#.#.......#.....#...#...#...#.....#.#.#.#...#...#...#.#...#...#...#...#.......#.#...#.........#...#.#.#...#...#.#
#.#.#######################.#.#.#####.#######.#.#.#.#.###.###.#.#.#.#.###.#.#.#.#.#########################.###.#.#######.#.#.#.#.#.#.#.###.#
#.#...................#...#...#.....#.........#...#...###.#...#.#.#.#.###.#.#.#.#...#...#...#...#.........#.....#.#.....#...#...#...#.#...#.#
#.###################.#.#.#########.#####################.#.###.#.#.#.###.#.#.#.###.#.#.#.#.#.#.#.#######.#######.#.###.#############.###.#.#
#.#.................#.#.#.#.......#...............#.....#.#.#...#.#.#.#...#...#...#...#.#.#...#...#.....#.........#...#.............#.....#.#
#.#.###############.#.#.#.#.#####.###############.#.###.#.#.#.###.#.#.#.#########.#####.#.#########.###.#############.#############.#######.#
#...#.....#...#.....#...#.#.....#.#.......#.......#.#...#.#.#.#...#.#.#.....#.....#...#...#.......#...#.....#...#...#...........###...#...#.#
#####.###.#.#.#.#########.#####.#.#.#####.#.#######.#.###.#.#.#.###.#.#####.#.#####.#.#####.#####.###.#####.#.#.#.#.###########.#####.#.#.#.#
#...#...#...#...#...#...#...#...#...#...#...#...###.#.###.#.#.#...#.#.#...#.#.#...#.#.....#.....#.###.....#.#.#...#.#...#.......#...#...#.#.#
#.#.###.#########.#.#.#.###.#.#######.#.#####.#.###.#.###.#.#.###.#.#.#.#.#.#.#.#.#.#####.#####.#.#######.#.#.#####.#.#.#.#######.#.#####.#.#
#.#.....#.......#.#...#...#...#.......#.#.....#...#.#.#...#...#...#.#.#.#.#.#...#.#.#.....###...#.........#.#.....#.#.#.#.........#.....#.#.#
#.#######.#####.#.#######.#####.#######.#.#######.#.#.#.#######.###.#.#.#.#.#####.#.#.#######.#############.#####.#.#.#.###############.#.#.#
#.......#...#...#.###...#.#...#.#.......#.....#...#.#.#...#...#.#...#...#...#.....#.#...#...#.....#...#...#.......#.#.#.........#.....#.#...#
#######.###.#.###.###.#.#.#.#.#.#.###########.#.###.#.###.#.#.#.#.###########.#####.###.#.#.#####.#.#.#.#.#########.#.#########.#.###.#.#####
#.......#...#.....#...#...#.#.#.#.....#...#...#.#...#.###.#.#...#.........#...#...#.#...#.#.....#...#...#.#.......#.#.........#.#...#.#.....#
#.#######.#########.#######.#.#.#####.#.#.#.###.#.###.###.#.#############.#.###.#.#.#.###.#####.#########.#.#####.#.#########.#.###.#.#####.#
#...#.....#...#.....#.....#.#...###...#.#.#...#.#.#...#...#.###...###.....#...#.#...#.###.....#.#.......#...#.....#.#.........#.....#.....#.#
###.#.#####.#.#.#####.###.#.#######.###.#.###.#.#.#.###.###.###.#.###.#######.#.#####.#######.#.#.#####.#####.#####.#.###################.#.#
#...#.#.....#...#...#...#...###...#...#.#.#...#.#.#.###...#...#.#...#.#...#...#.#.....#.....#.#.#.....#.......#...#...#...#...#...#.....#.#.#
#.###.#.#########.#.###.#######.#.###.#.#.#.###.#.#.#####.###.#.###.#.#.#.#.###.#.#####.###.#.#.#####.#########.#.#####.#.#.#.#.#.#.###.#.#.#
#.....#.........#.#.#...#...#...#.....#.#.#...#.#.#.#...#.#...#.#...#...#.#.###.#.#...#...#.#.#.#...#...........#.......#...#...#...#...#.#.#
###############.#.#.#.###.#.#.#########.#.###.#.#.#.#.#.#.#.###.#.#######.#.###.#.#.#.###.#.#.#.#.#.#################################.###.#.#
#.....#.........#.#...#...#...#...#...#.#.#...#.#.#.#.#.#.#...#.#.#...#...#.#...#.#.#...#.#.#.#.#.#...#...#.........#.....#...#...#...###...#
#.###.#.#########.#####.#######.#.#.#.#.#.#.###.#.#.#.#.#.###.#.#.#.#.#.###.#.###.#.###.#.#.#.#.#.###.#.#.#.#######.#.###.#.#.#.#.#.#########
#.#...#.....#.....#...#...#.....#.#.#.#.#.#...#.#.#...#.#.#...#.#.#.#.#.###...###.#...#.#.#.#.#.#...#...#.#.......#...###...#...#...###.....#
#.#.#######.#.#####.#.###.#.#####.#.#.#.#.###.#.#.#####.#.#.###.#.#.#.#.#########.###.#.#.#.#.#.###.#####.#######.#####################.###.#
#.#.........#.#.....#.#...#.#.....#.#...#...#.#.#.....#.#.#.#...#...#.#.........#.#...#.#.#...#.#...#...#.......#.......#...#.........#...#.#
#.###########.#.#####.#.###.#.#####.#######.#.#.#####.#.#.#.#.#######.#########.#.#.###.#.#####.#.###.#.#######.#######.#.#.#.#######.###.#.#
#.#...........#.....#...#...#...#...#.....#...#.#.....#...#...#.......#.....#...#.#.#...#.###...#.....#.....###.......#.#.#.#.#.......###.#.#
#.#.###############.#####.#####.#.###.###.#####.#.#############.#######.###.#.###.#.#.###.###.#############.#########.#.#.#.#.#.#########.#.#
#.#.#...............#...#.....#.#...#...#.......#.............#.......#...#.#...#.#.#...#...#...#.....#...#.......###.#...#...#.###...#...#.#
#.#.#.###############.#.#####.#.###.###.#####################.#######.###.#.###.#.#.###.###.###.#.###.#.#.#######.###.#########.###.#.#.###.#
#...#...#...........#.#...#...#.#...###.........#.............#.......#...#.....#...#...#...#...#.###.#.#.#.....#...#.#...#...#.....#...#...#
#######.#.#########.#.###.#.###.#.#############.#.#############.#######.#############.###.###.###.###.#.#.#.###.###.#.#.#.#.#.###########.###
#...###...#.........#...#...#...#...#...#.......#.............#...#...#.............#...#.###...#...#.#.#.#...#.#...#.#.#...#...#...#.....###
#.#.#######.###########.#####.#####.#.#.#.###################.###.#.#.#############.###.#.#####.###.#.#.#.###.#.#.###.#.#######.#.#.#.#######
#.#.#...#...#.....#...#.#.....#.....#.#...#...#.....#.....#...#...#.#...#...........#...#...#...#...#...#.#...#.#.###.#...#.....#.#.#.....###
#.#.#.#.#.###.###.#.#.#.#.#####.#####.#####.#.#.###.#.###.#.###.###.###.#.###########.#####.#.###.#######.#.###.#.###.###.#.#####.#.#####.###
#.#...#.#.#...###...#.#.#...#...#.....#...#.#.#.#...#...#.#.###...#.#...#.#.....###...#.....#...#.#####...#...#.#...#...#.#.#...#.#.#...#...#
#.#####.#.#.#########.#.###.#.###.#####.#.#.#.#.#.#####.#.#.#####.#.#.###.#.###.###.###.#######.#.#####.#####.#.###.###.#.#.#.#.#.#.#.#.###.#
#.....#...#...#...#...#.#...#.###.......#...#.#.#...#...#.#.#.....#.#...#.#.#...#...#...#.......#...#...#...#.#...#.###.#.#...#.#.#.#.#...#.#
#####.#######.#.#.#.###.#.###.###############.#.###.#.###.#.#.#####.###.#.#.#.###.###.###.#########.#.###.#.#.###.#.###.#.#####.#.#.#.###.#.#
#.....#...#...#.#...#...#...#.#.........#...#.#...#.#...#...#.......###.#...#...#...#...#.#.....#...#.#...#...#...#...#.#.....#.#.#.#...#...#
#.#####.#.#.###.#####.#####.#.#.#######.#.#.#.###.#.###.###############.#######.###.###.#.#.###.#.###.#.#######.#####.#.#####.#.#.#.###.#####
#.#.....#.#...#.....#.#...#...#.......#...#...#...#.....#...#...........#...#...###.#...#...#...#...#...###.....#...#.#...#...#...#...#.....#
#.#.#####.###.#####.#.#.#.###########.#########.#########.#.#.###########.#.#.#####.#.#######.#####.#######.#####.#.#.###.#.#########.#####.#
#.#...###...#.#.....#.#.#.............#...#...#.........#.#.#.......#.....#.#.....#.#.#.......#...#...#...#.#...#.#...###...###...#...#...#.#
#.###.#####.#.#.#####.#.###############.#.#.#.#########.#.#.#######.#.#####.#####.#.#.#.#######.#.###.#.#.#.#.#.#.#############.#.#.###.#.#.#
#...#...#...#.#.....#.#...#...#...#.....#.#.#.#.......#.#.#.........#.###...#...#.#.#.#.#...#...#...#...#.#...#.#...............#.#.#...#...#
###.###.#.###.#####.#.###.#.#.#.#.#.#####.#.#.#.#####.#.#.###########.###.###.#.#.#.#.#.#.#.#.#####.#####.#####.#################.#.#.#######
###...#.#.....#.....#.###...#...#.#.#.....#.#.#.....#...#.#.....#...#...#.....#.#.#...#.#.#.#.....#.#...#...#...#...........#.....#...#.....#
#####.#.#######.#####.###########.#.#.#####.#.#####.#####.#.###.#.#.###.#######.#.#####.#.#.#####.#.#.#.###.#.###.#########.#.#########.###.#
#...#.#.#.......#...#.#...........#.#.....#.#.#...#.....#...###.#.#...#.......#.#.....#...#...#...#.#.#.#...#...#.........#...#...#...#.#...#
#.#.#.#.#.#######.#.#.#.###########.#####.#.#.#.#.#####.#######.#.###.#######.#.#####.#######.#.###.#.#.#.#####.#########.#####.#.#.#.#.#.###
#.#...#.#.#.....#.#.#.#...#...#...#.#.....#.#.#.#.#...#.#.......#...#...#...#.#.#...#.#.......#...#.#.#.#.#.....#...#...#.......#...#...#...#
#.#####.#.#.###.#.#.#.###.#.#.#.#.#.#.#####.#.#.#.#.#.#.#.#########.###.#.#.#.#.#.#.#.#.#########.#.#.#.#.#.#####.#.#.#.###################.#
#.......#...###...#...###...#...#...#.......#...#...#...#...........###...#...#...#...#...........#...#...#.......#...#.....................#
#############################################################################################################################################"""

TEST = """###############
#...#...#.....#
#.#.#.#.#.###.#
#S#...#.#.#...#
#######.#.#.###
#######.#.#...#
#######.#.###.#
###..E#...#...#
###.#######.###
#...###...#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############"""

from collections import defaultdict


def find_all_shortest_paths(
    walls: set[tuple[int, int]],
    end: tuple[int, int],
    height: int,
    length: int,
) -> dict[tuple[int, int], float]:
    def is_passable(i: int, j: int) -> bool:
        if 0 <= i <= height and 0 <= j <= length:
            return (i, j) not in walls
        return False

    visited: dict[tuple[int, int], float] = defaultdict(
        lambda: float("inf")
    )  # i,j -> steps from end
    to_visit: list[tuple[int, int, int]] = [(0, end[0], end[1])]  # steps, i, j

    while to_visit:
        steps, i, j = to_visit.pop()
        visited[(i, j)] = min(visited[(i, j)], steps)

        for io, jo in [(0, 1), (0, -1), (1, 0), (-1, 0)]:
            new_i, new_j = i + io, j + jo
            if is_passable(new_i, new_j) and (new_i, new_j) not in visited:
                to_visit.append((steps + 1, new_i, new_j))
            # visit it even if it's in a wall
            visited[(new_i, new_j)] = min(visited[(new_i, new_j)], steps + 1)

    return visited


def part1(INPUT, minimum: int):
    walls: set[tuple[int, int]] = set()
    start = 0, 0
    end = 0, 0
    height = len(INPUT.split("\n"))
    length = len(INPUT.split("\n")[0])
    for y, row in enumerate(INPUT.split("\n")):
        for x, c in enumerate(row):
            if c == "#":
                walls.add((y, x))
            elif c == "S":
                start = (y, x)
            elif c == "E":
                end = (y, x)

    shortest_paths_to_end = find_all_shortest_paths(
        walls=walls,
        end=end,
        height=height,
        length=length,
    )
    shortest_paths_to_start = find_all_shortest_paths(
        walls=walls,
        end=start,
        height=height,
        length=length,
    )
    initial = shortest_paths_to_end[start]
    saves: dict[int, int] = defaultdict(int)  # saved -> count

    for index, (i, j) in enumerate(walls):
        # print(f"{index} / {len(walls)}")
        cheat1 = (i, j)
        steps1 = shortest_paths_to_start[cheat1]
        for io, jo in [(0, 1), (0, -1), (1, 0), (-1, 0)]:
            cheat2 = (i + io, j + jo)
            if cheat2 in walls:
                continue
            steps2 = shortest_paths_to_end[cheat2]
            steps = steps1 + 1 + steps2
            if steps < initial:
                saves[int(initial - steps)] += 1
    # print(saves)
    total = 0
    for k, v in saves.items():
        total += v if k >= minimum else 0
    print(total)


def part2(INPUT, minimum: int):
    walls: set[tuple[int, int]] = set()
    floors: set[tuple[int, int]] = set()
    start = 0, 0
    end = 0, 0
    height = len(INPUT.split("\n"))
    length = len(INPUT.split("\n")[0])
    for y, row in enumerate(INPUT.split("\n")):
        for x, c in enumerate(row):
            if c == "#":
                walls.add((y, x))
            elif c == "S":
                start = (y, x)
                floors.add((y, x))
            elif c == "E":
                end = (y, x)
                floors.add((y, x))
            elif c == ".":
                floors.add((y, x))

    shortest_paths_to_end = find_all_shortest_paths(
        walls=walls,
        end=end,
        height=height,
        length=length,
    )
    shortest_paths_to_start = find_all_shortest_paths(
        walls=walls,
        end=start,
        height=height,
        length=length,
    )
    initial = shortest_paths_to_end[start]
    saves: dict[int, int] = defaultdict(int)  # saved -> count

    def dist(s: tuple[int, int], e: tuple[int, int]) -> int:
        return abs(s[0] - e[0]) + abs(s[1] - e[1])

    for index, (i, j) in enumerate(floors):
        # print(f"{index} / {len(walls)}")
        cheat1 = (i, j)
        steps1 = shortest_paths_to_start[cheat1]
        for cheat2 in floors:
            if not (0 < dist(cheat1, cheat2) <= 20):
                continue
            steps2 = shortest_paths_to_end[cheat2]
            steps = steps1 + dist(cheat1, cheat2) + steps2
            if steps < initial:
                saves[int(initial - steps)] += 1
    total = 0
    for k, v in saves.items():
        total += v if k >= minimum else 0
    print(total)


part1(TEST, minimum=1)
part1(INPUT, minimum=100)
part2(TEST, minimum=50)
part2(INPUT, minimum=100)

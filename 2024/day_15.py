INPUT = """##################################################
#O#...O...O..#....O.OOO..#...........O.#..#.O..#.#
#...O.#.O....O.O#.....#OO....O............O......#
#..O.#.OO.O.......#.O#O..#..O.O...#.OO.OO.OOO#O.O#
#..O..O.O..O.O...OO.O.OO.#.##....O.O#.O...#O..O..#
#..O.O....O...O...O.OOO.O.O.....#.OO.O.O.#O.OO.O.#
#.....O..#......#......O.....#....#..O#O......O..#
#.....OOOO.........OOO.O.O.O...OO.O.......O.....O#
##.O..#.O.......#.....OO.......O...#.........OO..#
#.O.#....##..O.O..O#....OO.......O..OO#OO....#...#
#...............O....#O..#O..OOO.O.#O.O#.O.#..O..#
#OOO#..O.OOO..O.......OO#O..#..O.O#.....O.O..#...#
#O...O...#O....O..O.O...O#.O.#..O#O..OOO..#...#..#
#.....O.O...#...O.OO....#.O#...O..O.O.#....O.#...#
#O.....#....O..O#.O.O...O.O..OO##..#O......O#...O#
#O...O.#..O#...OO..O.#O.....O#.O.O.O.##O...O...OO#
#...O#...#.O.O.......OO..O..O.OO.#.OO.O..O...##..#
#..O.O..OO...O...O..OOO.O.......#.....#.O..O#...O#
#.O.OO#...O..#.OO.#.#.#..O.OO....O.#O#..O.OO.....#
#.OO..OO.OO...OO.....#....O#.O.OO#O#O...O....##.##
#...O..O.OO#..#....OO........#.#........#........#
#..#..O.O...#..O.###O........OO..#O.O..OO.O.O.#O.#
##.OOO..OO.#.O......#.O...O.O...#O#...O....#O...O#
#...O....O..O...OO.......O...O.OOOO....O#O...O#..#
#....O.O......#.........@.O..#....##O.#...O.#...O#
#O...#OO#OOO......##.#.....#O..O........O..#...#.#
#....O......O..O...O.......O.O.....O.O..OO.#OO...#
#......O........O..O...O...#OOO.##...#..#...O...O#
#OO...O.O.O.OOO.#OO#.O..O..O...#O..O....O.#..O...#
#.O.O.#O....O#O..#.O#.OOO....OO.#.O.....OO....O#.#
#..O..O.O.O.#...O....O..#......O....#...OO.O...O.#
#....O#..OO...O......OO..O.O....#OO.O....OO...##.#
#..OOOOO#OO#.O..OOOO.O.....O.O.O.OO.....OO..OO..O#
#.....O...OO.O#..#..O.O#O..........O......O.O..O.#
#O..OO#...O...O..OO.OOOO#OO....O.O..O..OOO..#..O.#
#...O..O...##.O.#.OOO......OO..O....#........O.OO#
##...#O.OO..O....O#...#..OO.O.O..O...O#..#...OOOO#
#O.#.O.....O#O.O.....#O...OO..............OO..O..#
#..OO..O............OOO..O.O.O..O..O.......O.#...#
#.O#...#..O.O..#O..#..#O.O.....#....O.#O....#O..##
#O.O.O.O#..O.O....O#OO...O....O.OO.OO.O....#....##
##O.#..#.#....O..#O..O..O.#...O..O.#.OO#..O.....O#
#.#.............O.O#..##.O....O...#......O..O..O.#
#.O...O...O..#.O...OO...O.#OO#O.O..##.OO.#...OOO.#
#.O.........O..#.O...........OOOOOO.OOO##.#.O.OO.#
#....OO.O.........#...OO.O.O..O......O#.OO#.O..OO#
#.....O......O#..O..O...O..O..O.O...O.O..O.#O...O#
#.....O...OO...........O....OO.O.....O.O...O.#O..#
###.OOO...O##.O..O#......OO....O..#.OOO#O....OOOO#
##################################################

<>v>>>^v<<^<^^<^v<^^v>><v<<<<^<>>^>vv>^<<^<^^v<<>>>>^<>^^v<^^<^<>>><^>vv>>^^^<<<>^^v^<v^^>^v^>^^v><v>^><<<>^><^v<<><^>^>>v<vv>^v^^v<^>v<<>vv<<v<v<^><vv<<><vv<<<><<<<<<^<<^vv><><<>v>>vv<v><v>^>^^<>^^^v^<^>><><v<>v>v>v>>^<<<^^>v>>v<v<v<^^^<^<>v<v<^>v<<^<v^v>v><<>><<<^<><^^^<v<^<<<^<>><v<><^>><^^>v<>^^vv<<<<>^^^><v^^<<<vvvv>><>>^><^v<^v^>^v^<>^<<^^>>^vv<^^v<<>>vvv^<v>^<^vv>v^<<<vv<<^>v><>><><v>v<<<vv><<><vv<><<<>v^>v^<<^^^v>>v><^^vvv><v^><^<>vv>^^^^>v<vv>><>^v<v><<vvv<v^<<>>v^^^vv>^vvv>v^^><>vv>^>^>>>v<v^^<^vvvv<^v<^v><<<v>>><>>^vvvv>^v^<<><v<>^^^^>^>vv<^vv>vv<^>>v<vv>v>><<^^^^><<>>^v>>>^^^^v>^^^<>><<v^><v<vv^<<^^^<><<v^>>v><>^vv>^^^vvvv^^>>^<v><vvv<vv^<v<>^v<v>>v^><v<>^v<^v^<<<^>^<v<v>><^><^<<^vvv^^v^^v<^^v^^>^^><^><^<^>vvv^<vv><<^<vv<^<^v<^>v^^^^^v>^>>>^^v<>><>^<>>^v^v<<v<v<><vv>^vvv^^^v<^v^^v><>v><<><^v<>^v^^<<^vvv><^>>^vv<<<>^vv<^^><><<v><vvv^^>^>>>v><>^^<<<v><<v^<^<v^<<><v<^^v<>>vv>><^<<^<^^^^<><>v^<<^<^<><><v><>v<<v<^>v>vv>^v>^>^^^>^<v<<vv>^><><>vv<^<v<^^>>v>v<^v>>v><<>>^<>>v<>v^<^<
>v<><^v<>>>^^>>v^<^v^<^v^<><^^<>^<v^^v^^<^>^^<<><>>^v^^<v^^>v^^^>^^><v>>>>^<^^<^>v<v^>^><<<vvv>^>>vv>^<<v^<<^v<<<>>>vv>^v>^<vvv^v>><^<<v<><vv^<^>vv<<<><<>><v^v^<vv<v>vv<^<<>^vv<^^>>^^v>^<>>v><<<>vv>>v>><^^v^<>vv><v<^v<<<^>^<>v^<<<^v>^<^><v>vvv>>v>><<><><><<><>v^>>>>v<^v>^>vv^>v<v>^<^>^^^^v^^v<>v><<^>v<><><<<^^v<^v>^^>^v^>^^<<^<>^>v^v>>><^>>^^<<^><^v^v^v>>v^^<^^<>>^<^>^vv^^^>>>>>v<v><^vv><v<^vv^<>vv^vvv>><<v^^v>^^<^><^>>><<<<^^>v^v<<vvv^<^>^vv<v^<v^^v<>^<vvv>^<v<>><<v<<^^^<><<>v<<<>>vv><>>^^<><<^vv>v<v<v<v^^^<v>v^><vvvv>>^>vv^vv><>^><><v><v^>^^v>vvv<><v^>^>>^^<v^<>>>v<<v>>>>><<><^v<^<^><>>>^v<^<^<<>>v^>>v^<<v^^vvvv><v^>><^vv^>vvv>vvv^v<^><vv^<<<^vv<^vv><><^><<vv<^v^^v^<^^vv<v<v^v<<<>>vv<>><v<<^<^vv<>>v^>^v<<>v^^^^<^^v^^^^^<<><<<v<>^v>v>vvv<v>>v^vvv<v^v^><^^>vvv<vv>^v>^>^<^<^>v^<v<<^^>>v><v>v>^v^>><^vv^^><>>^<v>^>v^^^v><v<^<<^>v^>>v>>^<>^v<<<^<vvv>^>^<<>v<v<v^^<<v<<vv^>>^<^>^v<><v<^^<v^<>^<>^^v^<v^><>>vv>^^v<<^v<^v<<>v>>v<<><<^>^^^<<v<<<><^v><>^^>^^<><<><^>^^^>><<>>>>v<>><v><<v^v^<^<<^<>
>vv<^>vvv><>>vvvv^<>^>vvvv<v^>^vv<^^v^vv^^v><>^v^<v^v^^<><^<^<^^v<^<v^<<<<^v>vv^>v><><v<^>^vv><<>>vv<^<>v<v>vvv><v<<^vv><>>^>>v^<<^>>>^^>>>><<>>>vv^><^^<^^>^v^^><<^<>><v>>^>^><><<><^v<^v>><>^^vv><^^^><<vv>^<><vv^><<v<>><>^^<>^v^v>>^^<<vv><^^v<v<<^>v>><>v^v><v<vv<^vv>^><^vv<<^^v^<v^v>v^v^<v>^>^v>vv<<>v>^v^<><<v<<^>><v>v^>v^><<^<<v^^^^>^>^>^<v<>><v<v><vv^^>>^<><<<v^<^><<>vv>>^^v^^^<v<<^>v>v^<<>^<v^<<>v^<<v><vvv<^>>><<<^^v<>v>^v<^^><><v<><<^<v<<v>><>^vv><>vv^>^>>v>>><v<<>^v<vv<vv<^>v^<^>^v>>^v>^^<^<^<^><^<>>^vv^vv<<vv^^^>>vv<^>^><><v>>vvvvv>^><v^^<<<^v>v<v^^^<<v>v<vv>^v^^v^^>>>>v>vv<>>>vvvv^<v>>><vv>><><>v><v<vvvvv^<>>^>v<>>^^^<v^v>^<^><vv^<vv><>^<<vv^>^^>^v<^v^v^^>^^^>v<^<vv<>v><v<v><<^<vv<<v^<^<>v>>v<<v^^vv>v<^^v<vv<>^^^<v^^<^<^^<v^v>><<v<>>^>>><<<<^<>^v>^<v>v>^<v<<^^^^v>^vv^vv>^v^<^<^^<<>^^><<>><^v<<<v<>^v<>>^><><>vv<vvv>v><v<^v^><<^v<v><>>>vvv<<^>v>^v<<vv^<<<<<>vv>vv^v>^>^<>^><<>>^^v^>v^>v><v<^v><>v><>^<><v>>^>^^v>^<^v>>^>^v^v>>v><<^^^<^>v^>^>^vv>>vv^vv^>><v^^^<^<>>vv>^<v^<<v^>vvv^v^>
><v<>>v^<<>^<<vvv^>>^^v<^>>v^<^^vv>>>><<>>>vv>vv^>v<>>^<v^>^^^><>vvv^v><><>vvv^v>>v>^v^^<>>^>^v^^<>>><v<>>^^>>>>>^^v>^v<<<v>^<vv^^<v^>v^><<^<v<>>vv<<vv<v<v>v^vv>v^^v>^<>>>>><^<<^<vvv^^<^<<v^^><v><<^<v>v>>^^>>v>^^^^>>><v^v<<>>^^vvvv>v>>^<^>^>>>vv^v>^vv^^<<<<><^<^v^^^v<<v^<<<^v<>^>^vv^>^^>^^^v<<<<>^<<>^v<v^>><<><vv<<<><vv>v>^vv<^>^^^>v^<>^>vv<v^>>>>>^v>^^><>>v<<v^vvv^>^>^>^<v^>^>vv<<vv<<<v<>v>>v>^>^>>><v>vv^>><v<vv^<vv<^^v<v^v^^v><><v^>>>vvv<^^^<^><v<^v<<^v<>>v<vv>^<><v^^>^<>>^v>v<<>vv^>v^>v^<>>^<>vv><vv>><<<<<<>^^v>v^v^^>>><^<<vv^><^^<^v<v><<vv^^>^><><<<<>vvv<vvv^v>v^<>>>>^><^<^^vvv^vv<v<v<vv^><<>><^>^v^<<>vv<<<^<^><v<vv>^<<v^>^v^v>v>><^v^<v^>><><><>^<^vv>>>vvv^<>>^>^v<<^^><v<<v><v><<vv^^^^vvv>>v>^<>v>v<>>>>v<>vvv^<v>>^>v<v^>><>v>>v^v^^vv^v>^^<^>>^^v<><<v^<>>>>>vvv>v>^v^v^><<>v<<<<<<v^^<^^<^>>^vv>^>^<v<<>>^>^v<<v<<vvv^^><>^<v<>>v^^><^>v><v><>^^<^<v^>>v<>>><>^v><<^<v^>vv<^^<vvv^>v>v>><<^>^v^<>vv><v<^><<<<>v>^^<^><^>^<<<>><>>vv<>^><>>^<<v>^<>v<v^<^^^v^<<<>>^>^<^>>v^<^<^vv>^>>v^^>^^^v^>>>v
v^<<vv>>^<>v^vv>^><^v>vv<v<<<v<^>^>^<<>^<v>^<<^^v>v^v^<v<v>>^><v><^^^<>>^<^^<<^>^^>v>^<>^^^^vvv<vv<>v^<v>v^v^v<<^<<<^v<<vv<>^>^>>><v><><v><^^>>^^>^vvv>v^^vv^v^<>v<<^>v^>>>v^v<^<>^<>^^><><v><><v><<>v<vv^><vv^^v^>>v^v>^^<v^><<>^v><>^><<v>v^><>v><<v>vv<^>^<^vv>^^vvv>vv<<^v^^v<^<>>v<v<^<^>^^>><>vvv<<>^>>^<^<^<v<>^v><>v><v>^<>>vv^^>^<<vvv^<^v<>^><^^^^<v<vvv^vv^><v<<^v^v^^^^^<v<v^<<<>v^<>^><^^^>vv^<^^v^><<^<<>^^<^^<^v<^v^v<<<>^>v^>^><>^>^<>^>v><v<<v>^><>v>><<^<<>><<^^><><<vv<^<<<>^^v>v^><><^<>>><v<^^><^<v<<>>v>^>^>^^v>^<v^^>^v><>>>v>v>v<v>^vvv>^^<v<^v^^>^^<>^><^^>v<^>^^v^>^>^>^<<vvv><><>v<<>v^><<^<<>^v<>>>><v^^vv^<>>^>v^<><<v^<>v>><<>>^<>^<^<>v<<<v^^^<vv<v>^<vv><^v>^vv<>^v<^<><>^<v>^v<v<>>^vv>v^<v<^>v^^v<vv<v<^vv^^v><v<>><<<v>v><>^^<>v<^>>><v>vvvvvv^<^^v<>^><^<>v^>v<<<vvvv>^>vv^<^^<<>vv^vv^^<<>v^^<^<<<><v^^<^^v<><><vv<><v<^^^<^<v>><vvv>^<^^^^<vv>>^^>v<^>v<>><<<>v^^v<vvv>vv<<<^>>><<<v^<>>>v>^^v<v<^v><^v>>><<v<^^<<^^vv<<<><>^<^^<><>v<v<^>v^>>v>^^^>>>v>^^^^^<>^<<^<><v>^^>^><v>><^>vv^^^>>^>^v^v<
^>^^v><>><v^^<>>>^^^v^^><>>>v<^<>>^>^<^<v<>^><^vv<vv<vv^^<>v^<<^^^>^v<^<>>v<>^^v<^<vv<^><><^^^v>^v^^v>><>>v<<v<^>>vv>^>vv<v^v^^<v>^<><v><><vv<v>^vv<>><v>vv>^vvv<^<vv>v^^^vvv^^v><v^v^<>^v<<v<v^<vv<v<v>^v><^<^<<>^>>^v>>^vv>>>v^<^^^>^<><<<>>^vv>^^^>>><<v><<vv<^<>>vv>^>v<<v<<>>v>v^>^v^<v<^<^><vvvv^><<<v<v>>vvvv^^<v^v<^^>v<v<v^>v<v>^<v^vv><>^<v^<v<>^vvvv<^^><^>^>^v<v>^^<<>><<^^<<>^><^^>><v<>>v^^^^>^vv<<<><vv^>v>^v^v^<vvv>v<^><^>^v<^>^^>>v^>v<vvv>v^><vv^<vv<vv^v><^^<<^^><><v^<>>v^<<^^>v^^^<^>^^v>><v>^><>^<v^<^><<>v^v^<v^v>^>v>>v^<>v^>v><^>v^<<vvv^^^<v^v^^vv^>v>><vv<><<v^<>^^<v<>^>vv^^v<^><vv>^v><vv<>>>v<v^<^>>^>^^>>>^<><v<^vv>v^<vv^<<<^>^>^^v^^v<<v^<^<<>>^>>v<^v<^^<^v<^><vvv^>^v^^vv<>^^^v<^v^>v^><^<<v<<v><>v>vv^>><v^^vv<^^<>><>v<<v^>v^^<v^>v<<^><>vv^>>><>v<^>v>^>^^><^<v<<>^>v>v>^^<v>>><>>^v^<<^<<^v<^><^<v<vv^v>v^^^v<>v^^v<<v^<^>v^>^<v>v^v<>><<>v>>^>v>v><>>><<^><v^^>v>v<>v>>^^<^<v^<>v^vvv^>v^^^^<<v^><><>v>v<v^v>v^vv<<>>v<><v<v<v><vv^^<v<<><>>>^<>v<<^^<^^v<^>^v<^^<^vvv<>v^v>v<^>>>vv^v>>^<<vv>^
<^^v<>v>^>>v>v<v>v>^^>v<>^vv^<<>>vv>v<<>vv>v<v^>v>><<<>v>>^<<vv>^v>>^vvv<v^v<^vv>>vvvv>v^v^^<<vvv<^^>>><^<v<>v<v>v>>>^^>^>>^^>>^vvv^<<<<^v^v^v>>^^v><>>>><^^<v><<v^<v>^^v><vv>><v<v^v^>v>>^^^v<<^><<v^^<^<<<><^^vvv<><<vv^^<>^v<^>vv>^<^<>>>>^^^v^>^^v<<^><^v<><^v<^v<^<^vv^<^<^^v^^>^<>^v>^<v<>^vv^<v><^><^^v<^v>^<^vvvvv>><<^^^^<>^^^v^>><>^><^<<vv>>>>v>v^<<><^v<<^<>>>vvvv^^>^<v>v<v>>>^^<^^^^>v<^><>><v<v^<>^><>>>^^>^>><^<v<vv<<^<v>><v<^^^<<^<v><<v^<<<^v^<>>v<v<>vv^^v<>>^^v>>v>>^><^<>v^<<^v<v<<^^v^^<>v<<>^>v<>v<>^>>^vv^^<<^<v^>v<>^<<<v^<^v<^^<><v<<v<^^<><^^<<^><^<<<v^<^>^v>vv>>>^<^v<^<vv<v>v^<><>v^<v<^<v^>v^<<>v^>^>v<v><^<<<v^v<><<vv>>v^v>>^^^><v^^<^^<vv<>><^v>^><<<v<^<vv><^v><^v^>>^^vvv>>>^>^v>>>>^>vv^><vv<<vv^>^<<>^>>^^vv^v>^^><<v><v>v<<>^>><><v>vv^^>v>^><<<v><>>>>>>^>>v>>>^<<<^^^v>vv<vvvv<>v^>>>>>v<v^v>>><<>^>^>>>^v>^^>^>v<^v^^v<>^><<^<>^^<^<^^<>>v^^^v>^v>v<>vvv>v>>>^><v<v<>^>>^<<>^<vvv<^^v<<^>><^<v^v<vvvv<^v^v^>v^vvv<>vvv>>v^>v>^><v^<v^v^v^^v>v<^v>v>^v<><>^^>^<<>v^><v^v<>^<v^>^><<^<>><>^^vv<
<><^^<>^v>v^^>>^^^<<>^v^>><<<>v<v>^^v>><<<v^v<>^<>><>^^^vvv<>>^v<<v<v>^^^>v^>^>^>vv^>v^>^v<v>v<><v>v>><v<>v<<>^>^<^<^><><>vv>^>^vvv<>^<^v^>^<<<>v^vvvvv>^<>vv<^^<<>vvv^>>>vv>^^^<v>^^^vv><^v<v<>>v<>>^^<<<v<>><<>^v>^v^^<v<><<^^v<v^^>^^v<vv>>^v^>v>>v^^^^^<^v>>vvvv>>^^>>^v^v^<>v^vv^vv^^><>>v>^v^>^^^vv>^^>^v^>^<v>>><>vv^v<vvv^>vvv<^^<<^v<v^v<>>>^<<^><>v><<vv^vv^<<<>>vv><<><^^vv^^><vv>vv^v^>vvv^v><^^<^v>>><<>^>vv^^vv>v>v^v^^^^<^vv^<><vv^^v>>v>><^vvvvv<<v<^v>v>^><>^<vv<^>>>v^<<^>v^^<>v^<^<^v<^^<vv><>>>>^^>^><>><><>^>v>^<^><<^v<^^<v^<^^v>>>>^>v>v>v>v^>^>v>>><>v^^^v^vvv><^^>><v^^<>^>^>v>^^<^^vvvv^^<>^^>v^vv<>^^<<vv>^<><<v>>>^^^<vvv^>><^^v<<<>v><v<^^>^v>^v>^<^^^<^>^^<v>><>^<><>v>><vvv><^>>vv^>>>v>><<v>^<><^^>><<v^v^>v^v>vv<<v^v<>^><<<<<v^v<>>>><>>v<<v^>^^>>vvv<>^v<<>^><<><>^^><^>v<^^^>^<^^>^^v>>^v><v^>><<v^^<^>^>^<^><v>><<^^>v^>v^^<^<<^^^>vv^><vv^>vv>>v>v<v>v<<^v<><><^^^v^v<^<^^>vv>^vvv<^><<^>^v<<v<>^^v^v^><<^^^v<^<<>^>v^^^^<>^v^v^>v<^><vv>>^vv<>^<v^v^<<<^<>><<>^^^v^^><vvv<<<vv><>v<^>>><>^^><>><<
v<v>^<^>>^><>>>v<v<v<<<v^<<vv<vv>v^v><<>^v^v^<v<^<>^><v^>><><>><v><^<>^<>^<<<^<>><^^v><<>>v^>^<<v>v><^>^vvv<>^><vv><v^^^v^v>v<^>^<^>^v>>v>><v>^^v^^^v^^<><<^^^>>^<><^>v<vv>><^v<^^<^v><v^>v>>v<v^<<v>>^><v<>v^^><v<^v>v>^^^v<>^v<>^<<vv>v<^>><v<>v>>>><<^>>v>^<>^^<>^v^>^v<vv^><<^<>v^^><v^^>v>vv>^v^<^><v^^^vv^>^>vv^<^<>^>v>^vv<<^vv^<<><<>^^vvv>^^>^>^<v^><<>vvv>>vvv>>>v>v<<v>><<><^<><^v>>v^v^<<^<vvv<<<v<<v^vv><^<>>^<^>>vv<vv^<^^^vv<>>>^^<>v^^><<<^>^vv^<<v>^<^<vv^^><^v><>^<v>>^v^>>^^<><^^^>v<<>v<^>>v>>v<v><>>^v>^>>><>v>^>v<^><^>><^v<^v<>v^^^<^<<^v<<v<<<v<>>><<^<>^^^^^^>^vv>>vv>v^<v><><vv^<><><<<<>v<^vv^^<<>v>>v^>>^>^v>v^v^>>>^>>v^><v^<v^<<<v^<>^^>v^<<v>^^v>><^^>^><<>^v<>v<>>>v<<v<><vvv<<v<<v>>><>v><v^^>v<<vvv<><v^<v<<vv>^v^<><^v>>v^>v<^<vvv^v<vv><><^<<v^><>>^<<<<<v>^^vv<vv>v<v^>v>v^>^v>>^vv<<^>v>^^v<^<^v<^>><vvv<<>v^<^^<vvv>>v<^>vv^>^<<<^^^v>^^^>v<^<<<<>v^v<v>^><vvv<>>^vv>^>>>vvv>>^^^^^>^v<>^v^v<<>^<>>v>vvv>^^v>^>v^><<>v>^^<^<v>v^>vvvv>>v>>^^>vv^v^^v><>^^^<<>^^vvv><<^<>>^<<<>>v>>^^^<<^<<vvv>^<>
^<>v><vv>v^^>><^v^><><v>>^<v^^><>>^>>^vv><<^v<v<>>>^vv<^<v>>>^vvv<<^>^><v<v<^><>>v>vv^^v<<^^^>^^^v>v^<<^vv>>^v>vvv>^v^^>v>v^v<>v^^<>^v>>>><vvv><^v<^^^>v^><>v^^>v<>vv<>vv<<^<vv<^<>vv^v><vv>>>>^v^>^^><v<v<^<<><v>v^><><<^^v<<>v^^^>>v<<vvv><^^>^v^vv><>vv>><>v<<v^>>>>>^>^<>v>v><<v<vvv^>^<><>>^<<v<^vv^>>^^v^>^v>v^^^>v^<>v^>>^^vv<^>^^vv>v><<<<>>>v<v^><v<<><^^v^v><<<^^^<v^<^v<v<>^><>^vv>^>^<^^v>^v>>>v<<^>>^^^<<>>v^><^v^v<v<v^vv^><><>^^^>v<<v>v^v>>vv>^><^^vvv<^v<>^vvv<><^v<^>><^>><>^^^^>^v<><v^^vvvv<>v^>^>^v<><v^^v^^<v><^^^<>v^v><^<<v<<>><>>v<<<><<>^>^>v^^v^^<<><>v><><>vv>^<<<v^>vv^^>v>>^^^^^^vvvv^<<^v>>vvvv>vv^^v^vv^<vv>v<<v^^>>>^><^^v><^<v>^>^^<^^^>v<^<><<<>^^^^><<^<>v>><vv>^^><<>>vv^^>^<>vv^^^>v>v>><<v<<^^>vvv>v>vv>^><v^>v>><>>^>>v<^^<<^>^>^<v>><v<v>>><>v^><vv^^vvv^<>>vv^v<v<<><<^v^^vvv^<v>^>^^vv<<<v>^<<v^>>^>^<v>^^vv<v^^^v><v>^>>>^v>^<><<^>^^>^v><v^v<vv<^>>^^<>>^^><^^^<<v^^^^>^vv^^<v>v<^<^><vv><<<<>v><v><>>>>>>^^<^^<^<><>v<<^^vv^^v<<><^^>^>vvv><>^^<<<><v^>^>v^<v^<^^<<<^>><v^<<<<<>v<v^v>>v>^
v<<v^>v<^^^^^v^<>v<^v^^<<^vv^v>^v<^v<>^v<<vv>vv<<^^>>>><^>v<^><v^><vv^>v<>^<><><<<<^v^><^vv>^^^><<<^<<^^>^^<v^v>>v>^v>>^>>>v<>>>><<<>v^>v<<v>^vvv<>>^^v>^>v><<<^v>^^<v^<><<^>>>v^><^><>^><v<>v^v>^vvv<>>^>^><>^v>>^>vv<^><>>>vvv<vv>>>v<v^^^v>>>>v<<vv^v>v<>>^^<>v^^v><^^<vvvv^^v>v^v><^v^><^v^<><vv><>v<>vv<vvvv^v^<<>^v<>^^<>vv<^>v^^vv^^<^v>>v>v^vvvv^<<<v^vvv<v><^vv^v^^vv<<><^>v>vvv<^v<><<^<v<<<vv<>>>^v><>>v<v^^>><^^><v<><^><>><v><<>>vv^^>v<^<^^<^>^<v<><^v>^v><^<<>^^<<v<^>v<v>^>><>v>>v^vv^>><><>^>><^v^v^>v><><v^<<>>vv^<>><v>v<^<<^<>^v>v<<><^^^<>^^vv<>vv><^^vv<>>><>^vvv>v^^>v^v^^<>v<<><<^^^<<^>vvv>>>^<v><><>>^<^>v^^v>v<<v^^^>><vv^>>><<^^vvv<>v^<^>^v<v<>^<^<^^<>^^<<<^<<<v<v><^v^>^^><^^>v^v<v<<<v<^<>^^<<v^<<<<^vv>^><^^>v>^v<<v<v>v^^>>><><^<<<v>>^^<^<<^v<v^^>><^<v^v^^>^v<v^v^^^v<<>^><><>>^v<v<v<v^v<<vv>><^v^v^v>vvv><<vvv^<<^vv>v>>v<><>v^v^v<^^<v>^vvv^<^vv^v>^^>v^v>vv^<^<<>>><v>><v<<>^<^v><vv^vvv>>^<<><<<<><<<^>^>^^>><^<^<^v^v<><><v^v^^><v>^>^<^>^<<v<^^vvv<<v^<v>v<>>><>^^>^v>v^>><>^><vv>><<><^v>v>^
>vv^^<vv^>^>v<><>>>>>v>v<^><<><<<^^^^v^<^v<<vv^v^>^<>>^v>>>><^v<v><vvv<v<><^<^vvv^^<^v^^<^^^^^v>><<v<^<^^>^><<<>><vv^>><^<^<<vv>>>^<v^<vv<><v<<>^v<<>><^^>v<<v>v^v>>^>>^^>^<>v<v><v>v<><<><^>^v^<>v>^>^vvvv<^>>v<v^><v^<vv>v<<><vv^v^>v<<><><<<<^v<><<v<^>^<>vv>v>vv<^<>^vv<<v^>vv<v>v^<v^>>^><<<^>^>v^^^^><vv><<vv^v<<^><^^<<^>^v><v<>v<v^v<><>v^>v<<>>>^v^<>><^v^v^^>v><<<^v<>>>vv><<><<^<vv<^<>^v<^^v^>>v>^><^v<^>^<vv^><>^>^^^>v^>>^^v<v>^v>>^<><^^^>>v^<vv<v<>^<^^>v^v^^>>vv<v^vvv>^>><vv>^v>v>v<<>v<>v<><<<^>>^<<v^^>^^v>v^<^^vv<<<v<^<^^<>>><v><<v<v>><vv>v<^<<<v>>><><><^<>>^^^vv<>>^<^><<v^>>v<<>v>^<^v^v<<>v>>^^<<<^^v^v^^<>v>>^^<v<<^v^^^<^>>>>^v<><^v>>>^<^>>^vv><>^^<>>v^^<vv>v>>vv<><v<v>v>^^<<<^v<>^<<>v>^vv^>^<>>^v^v^>^^><<>^>>><^<v^<<<^>>>v>^v>^<vv><^>^v>^vv>^>>v>>vv^vv>><<<v<^>vvv^^><v>^^>v<v^><^<vv<><>^v<^<^>^>^<^v<^<<>v>>^^^^>^v>v^>^^^^^>vv^v<vvv^v>^vv^v^^v>^^<^>v<^^^^<<vv>^v^<vv^>^vv<^v<<v><<^>v^^vv^<<>^><^<v>>>>v^^>^<v>>^>^<><<v^>^>^^><<<^^>^>v^<<v<v><v^>>v>^>^vv>><v^v^^<v><>^v^v^<<^<v>v<<v<>>>v^
<<<<vvv>v>>>^<v>>><v<^><><^^><<>v>^v<^vv^v>><^<>><^^v^<^<^>>>>>^>><^>^<><<^<><^>><^<<><^<vv^<>>v<^v>^<<>>vv<>vv><^^v^<v>v<<v^>vv^><>vv>>><><^>>>>v^vvv^v><<<^^<>v^<^v^<^<^^v>v^v^^<^>v>>vv<^v<>^^v<^vv^>v<vv^<vv^>>^<><v>^<<><v^>v<<<vv^>v<^<>vvv><v^<^>v<^^>v<^<<^>><^v<^^<^>^<<vv<v>>v<v^>^><<v<^v>^^v<<><v><>v>^^^^v>>vv>>v^v>^>>^^vv>>v^vv>v>>^vv>v<^>^v^><>><>><v^><<>><<vv><^v^^v<v<<v<<v>v^>^^v^v>^<><^<<v<vv<vv<><>^<<<v>>>^>v<<><v<<v><><>v^>^<>>v<^>v^vvv^^>vvv<^<^<v<<<>v^<vv<>^^>^<>v>^><^^>>^>v^^<>^^^^<v><^vv>>^vvv<><><<^vv>^<v^>^<>>>^<>v<<^^^^v^><<>>>>vv>>>vvv<<vv>><^^vvvv^^><^v^<v<^<<<^<^vv<>v<>vv<>v>^<<>^^>^<>vvv^v>>v>v^<^<^<><vv^vv>v<<><^^<>^v<>>^^v^><>vv>>v>>vv^v<^<vv^^><>^><^<>><<>>^^<v>v<<^^<vv^^^v<^<><<>>^vv>v>^v^v>^<vv<^^vv<^^>^v>>vv^<v>v<>>vv>v<<^^<<^vvv>>vv<v>v<v<v><<<v><<v><>^>>^<<>v^^<^<<<>v><>v^v>v^v<><>^v<^<<v>><^<<>^v<vvv^<>>vv>^^>>v<<^v^v<v>v<><^<v<v^<^<^^v<<>^^v^<v<^<vv>^vv^v>>>v>v^^<v<<>vvvv>>^^v>^^>vv^v>^>^v><vv<v<>>>^vv<<><<><v<<>>vv^<<<<^v<v^vv>^><<^^>^>^vv>><<<^<v^>>>>^
<<<vv^><><^^v^<>><^>^<<<>v>v<v^>><<^^v<><^^>^>^>v><<>v<>^^^<<<<><><<>v<<v<<<v^<<>>><>v><v<^v>v>v><^<v^>v<^<>>^^>v^v^v<vv>^>>>^<<<vv<>>>^^><>^v<v^vvv<v<<vvv>^v^v^^><>vv^>v<<^v>v<v<v><>>^vv>vvv^^^v>vvv>>v>>v><^>^^>^><v><>><>>>^<<<>^^<<<^^^v<>^v<>>>^^>><><<^v^><v<v^v^^^>v<>^>^<^v<v^^v><>v>^^<><><<^>>vv<^v>v<v><^>>^^^<^v<<v^<v^<><<^v<^^>v^vv<^>v><^<^^<><<vv>^^>^v<<<<v<^>^<>vv^><v><>^^^^^^v>v^<>^<^<>^v^v>>^>^vvv^^^><<v<v<><v<<>>v^^>>^v<<v<^v^>><^>vv<vv^><>><v^<v^v><^^v^<^<<^vvv<^^<v^<><v>v>v^<<v<v>v><<>^v^<^^>^v^<^^^<vv^<v<>^v<>v^<<>vv><>^v<>v^<^^v<<>>vv^v><<v<^^v^<^v^<>><>v<^^>^<vvv>><<^>vv<v>^<v<^vv^v<^^^>^^^>>^^^><v<v^<>^^<><>^<>>^<^<v^>>^vv^vvv<v^><vv<<<v^><<<^<^>^^<v^v^<vv^>v^^<<><>v<<v>^^v>v>^v<>vv<v<>v>>^>^>^^>v^vv><<>^><>^<v<v<^^^v>v>>^v<v^<v^^v<>>^^^v<<v^>>^v<<>>v>>>v>^^<^><>v>^^<^<<v^>>>^>v^v>>>v^<v<^>>><<<><>><^vv><<^^v<>^><<v>^v>v^v^<v<<<^vv<<>>><v<<<v>vv^^>v^v><v^^^>^^^^<<vv>>v>^<>v<<>>^^^<^<^^v>^>vv^>^<>v^<<^>^<^>^^<^^vvv<v>v<<>v<>><>^^^<>>^<<>v>^v<^v<^v<vv^vvvv^^v<<^<vv<^^><v
v<<vv^>vvv<v<<<v><<^<<<><v<>>>^v>^^^^>^^<><<<<><v<<>>>^^<<vvvv<<^^>^vv>^^>^>><>^<^^<v<v>vv>>>>v^v>><v<<vv><^><v<>^v><vvv>^^>v^>^^<><^^>>><<>^v^v<vv><^v^vv>><><v<^^<>vvvvvvv^v<^^<v^<<v<>^v>v^<<^^>>v>><v>>>^<<^^v>v^<^<^vvv<^>^<v<>vvv^>>>vv>v^<^^vv><v^vv>^v<<^>v<^v>^vv<>v^<vv<>>^v>>vv^>><<>v>^<^<^v<v>^v^<^v>><><v<<v>v^v<<>v>><^^^vv<v^^vv^^>^>^^^v^<^<>v<^>><>>^<>>v<^>^>v^vv<^^^<v^^><>v<<><<>^v<v>^<^^>>^>v>v<^v<^<^vv><<^^<^>v^v<<<v>v>vv^^><<vvv>^><>v>^vv><>^v^v>^vv^>>^v<>><<>v^v>^>v^>vv>>^<^^>v><^>vvv>v^<>^v>^<^^>^<^vvv^^^v<>v^>><^<>^><^><<^<^^><vvv<^vv^^<v^v<<<>^v>^><>v<<^<v^<vv^v^vv<<<>>^>vv^<<v<>^><<vvv^^vv<<<>>v>^>^<vv>^<<^v>^<v<v<v^<<<^^><<<^^v<>^^v><^v^v>^vvv^vv>v<>><<<v<>v<^>^v<>vv^>><<><^^>><^v<<v^<^><v^<v<<v<<v<^<^>vv^<<<>vv^v>>>v^^v^><v>><><vv<^v<v^^><v>^<vvv<>^^v>>v^v<v<^>^^^^^v<v>v<v<^><<^^><^^v<<>^<^>v^^<>v<><^<^v^v>^>>^<^^^^<^<vv<v^^><>^<<>vv>><>^^<^<vv>v>>v<>^^>^><><>^^v><v>^v>>^^v><^^<^v^<<<<v^<v^^^v<<>vv^<<v^^^^^>vv<<vv>><>>^vv><v^>^>vv<<>vvv>^v^<>^><>>v><>v><v^<^^><^^vvv^^
<<v>^^^^>^>>^^<>vv><<<^<^<vv<vvv>><^^^<vv>><^^<><<<^<<<>><<>v<>><^^^>^<<vv^^<<<vv^^^<<^^v<v<v>>^^>^^^>v><vv^<<vv<<^v<>>^<>v><v^vv^^<v^><^>^<<><^<v^^^<^>^^^v><<vv>^vv<<>^^v>>^^<v>>><v<v<v<<>v^v><<<v<vvv<><^><><^^>vv><<<<>>^vv>^vv>v<<^^<^v<>^vv><>v<^^>^^<^v^v<v>v^>v<>^v<vv<^^^^<^v>v<v<v>>^^^<<<<<><>>>>v^<>v<v<<<<^<>^^>>><^>^<<^^>>^>^<>^<vv><<<^v^^<v^<<>^>><vv>vv<^<v<^<^vv<v^^vv>>><>^^<<v^>>v>><^>><vv^<<>>^<v<v<v<><^^<<vv>^>><<^vvvv^vv>>vv><<^^^>>><<<>^v<>>><<>^>^v^^v^^<<^v<>>v^v^^v<v>^>^^^><^>><^vv^v<^><<>^v^>>^v^>^>v<^^>^^<^<^^v<<^vvvv>>v<<<<<^^>>v<>^v<<<v^>v>>^<^>vv><v>^<v^v^>^v^>^>vv>^^<^^v<>v<<<^vvvv<v^^^v<>^^>><v^<<>^>v^^^^>>^<v<>^v>v>^^v>>v^>><v^>>><v^^v>vv^>v>v>v<>^^v^><<>>>^>^^v^><^v><vvv^^v>^>>v>>>>v<<^><<><<<^<v>>vv<<^^v>^v<vv>>^vv^^<>^>^vv<vv^>^v<><^v<><v><>^<^>v>>^>^v><^>^>^v^v<^>^v<<>>^>>v^^<>vv^>^vv<<<>>><^>v<^<><<v>^^<>v^><^^^>vv>^<v<^<<v^<^<>^v^><vv>>^>v>v<>>>^vv<>^>>^<v^<v^^v<vv<v><<^>v>>v>v<^<><<><<><<>^<v^v<<vv<^v<vv^<^^<<^v<<<v^^<^<<<v<^^<v^>>v^>>^>v><^>^^>^^v<^<><>>v
^vv^<v>>>v<<>^>^^vv^>^v<<<>v^^^^>>^vv^<><<v>><>>>v>v><^><^v<<<v^^<^>^<v>>vv^^><^v>v>^><v<><<^><>^>>^>v^<<<>^^<><vvv><^^>>>>^><<v^<><v^^<^^^>v<v^^^v>v<>v>^^<><v<vv^>>>>^v>vv<v<v<v>>>>^vv^^<<vv><<<>v>^^>>^^^^><<v^><v>^vv>>v><<<<^v<^^>>>>^>^<^>>>>v^^><<^^>vv<^v><v^vv>^v<>^v^>><v>><>^v^<^<^<^^<<<^^<><><>^v><>v><<^vv^>v>^^^<v>vv^>^<>^<v>v^vv>>>><>><>^^<vv<<<>>^>^>>^^><vvv<<>>><^>v^<^^^^v<^>>>^>^v^^<^<^>v^>>^v^^>^<>v<vv>v>v^^><>v<<v<<^v^><v>v><<^<><<<v^>^v<vvv>^>^v^>v^<><vv<<<v>vv<>vv^v>vv^vvvvv<><>>^v>^v<vvv>v>v>>^<<>><^>^^vv^v>><v><v<v<v^^<<v<<<^>v^^v><v^<><>^v<<>>>v^^>><>>^<>v^vv<v<<>v>^<^^^v>v>>^^v^>^^vvv<vvv>v^^v<>><v>>^v^^>><v>v>>>^<^<vv^>^>v^v^<v^>>><v^vv^>vv<^vvv^<v<v<^^v<<v^v^<^<v^^v^^<vv^v^^<<vv>>>v>^<<<<v>>>v^^^^^<>^v><<^vvv>^>^^>^v>^<^v^<<v>v<<v><^v<^vv^<v>>vv^^^<^v^^><vv<<>>vv<>^^>v<^><>v>v>^>v<<v^>v^v^v>vv>v^><^>vv<^v>^>^^v<v<<>^^<vv^^^<^v>><v^^v^v^>^<><<^v<^vvv^>><^>v<^<^>^<>v^<<v^^<<^^^^v^><>^<^><^<v<v^v<^<<v^>vv^^v>^<<>^^^<><^<^^><vv^<>>^<>><>>v<<<<<<>^^<v^>^^<^<<v<<^>><>>vv
<<vv<><<v<>^^v>^v^>>^>v^vv^>>vv<v>><vv<vv><^^><^v^<^vv^>^>^>><v>>v^<vv>^<<<<<vv^vvv^vvv^<v^v><<^<><<>v^v<<><v<<<v<>^v>^^><<v<<>>^^><>v<<^^^<^<<^^^vv>>v^<v>^<>^>v^v^>vv^v<vv>vv<v<>^vv^^vvvvvvv><<^<>>>^v^><v^v>><>^^<^^>^^>v<^^<^vv<<>><><v><>v><vv^^^v^>vvv^v<^^^><<<^<>>v^<v^v<<<><<v>^<^<>>><<>>v><>vv^v^<<vvv>><<>^<v<vv>^<>>>^><<>^>v<<<^<v^^v<<>v>>vv><v^v<v<v>^^<v^v^v<^^>>^vv>>v<^^>>v>^><v><>v>v^>v<^^vv>^^^>^v>><v^^>v<<v><>^v<>>^<>^^^>v^<v^><v>^<^^^^v<vvvv^<^<>v^>v>^^vv<<^^><v<v<v<>v>^^<<^v>vvvvv>^^>>v<^<>><^<>^><>v<v<<>v^<vv<v><>>^v^^>^^v><^v^>v><v<^><>v><v<<^^>^<^vvv<<^^^^^<v^>^<<v^>><><vvvvv<^^^>v^>v>^<<<><^<vv<^v>^^<<v<v^><v>>^>^>^^v^<>^<>v^><v><v<<>^<v><v<>>v><<v^^>v^v^<><^<<^<><<vv>^^<^^v<^^<<^><^^v<v>v^v<^v><v>><<^>^^><^>^<<><>v^<>^v<^v<>^^^^<^<><^^v^<^v^v^v<<>><<>^<^v^<v<^>^v^^v^>^^<<^<>>>^v><<<<^>>><^^^^<<v^v<<^v><<<^^^<v>v>><^vv>>^><>>>><<<>><^v^>v<v<vvv^vv>>v>>^><><^v^><>v^<v>>^<>><<<><>vv>^<vv<v<<<>^v^>><^vv<vv^<^>><vv>>v>><^v<>^<v><<v>>^<v^vv>^^v><vv^>v>v><^<v>v^>>>^vvv^<<<^^>
>^v^^v<^v<vv<><>vvv^v<v<^>^<vv^<v<v>>v<>v<><>vv<v<<>><vv<<<v<^<<v^v>^^^^^^^^>^>>^v^^>v<v>^^>^<>>v>vv>v><>v^v>v^^^>^vvvvv^><vv<^<v^>>v>>^vv><v<v>v^v^<>^<><v<>^>v^<>vv^<<>>>><<<v><v><v^v^^>>>vvvvvv<^v<>v^>v><vv<v<<<v<^vv<>^<><v><v^>v>>v>>^vv><<vv^^>^^<^^>^>>><>>^><v<>^^^<v^^>>^<v<><^<v^v>v^>^^^>^v>^^^^>>vvv>^><><>v<<vvv<<><^<^>v<<<^>^<^<<v^vv^<^><^v^>>^<>vvv>^><v<^<<^<^<v><>^v<v<v<<^v^vv^>^>>v><<v^>v^<<v^<vv>v^v><><<><<><>^v^<^>>v^v>>^<<<v>>>^^^^v<>v^^>^>>v^vv><vv<<>>>v<^v><v>v^>^v<v<^><><v<^<<>>><^vvv<v<>^>^><<^>><v>^v<^^^^^v>>>>>^>v<>v^<<^v<^><v>v<><<<<v<^v>^v<v^>^<v><<^v>>v^<^vv^<<^>v>^^<^<^><<>^>^><^^><>>>v>>v><^^vv<^^v^^^<>vv<v^^v<v<>>>>^^v<<v><<v<<^vvv>^<^vv><vv<<v^<v^vv<<<>^><v<<^><^>v<vv^<^^^vv<<<v<v><vv>^>^><>v<<<>^^<<^^^vv^^v>v><^<vv>>^<<>v<^>^>><<<<v^><v>^<<vvv^v>vv>><>>^<>^<>><><^<<>>^<v^vv^^^vv<v<^<^<^^><>v<>v^v^<<><vvv^^^><^^>>><<><<^><^>>vv^>v<v><^<^><vvv><^v>v<<<<<^^<^<<<<<v^^>^>>^>v<^v^>v<v<>>vv<>vv><>^v<>v>v>v^^<><^vv<v><^<>vv<v^<v<>v><>v^v^><<^v<^<>^^v<^^^v>^^<v<^v>>^v
^^>v<<v<^<>><<<^v^<v><^<^^^v^v<^<v<<^v>^<<^<<vvv<v>v>v>^>^><^<>v><^>^v>><<<v<vv^><^<>^v^><v>vv<^><^><>>>^><>^<<<>v>>v>>v^>^>><^><v^>v>>v^^>>^<<><>vv><><>v>vvvv^v<v<v<v>>v><v<><<<>>v><^^>><<<><>^<v<>v^>v<v<>v>>>^<v^v<vvv^^v<>>^^vv^v<v<>^>v<^><v>v<^^<vv<v^>v>v<<vv>vv><>>^<<^<v>v^<v^v^<<v><<^<<>^^v^<vv^^^^<v>>^^<><v<^><<>^^>^v<>>>>>v>>><>^^<^v>>>><^^vv^<vv^^<<>v<^<<<><<<^<>v>>>vvv>^^><vv>>^vvvv><>><v>>>>^v>>v<v>>v<>>^^>><>v>v<><<<^^vv<<>v^vvv>>>vv>^v^><>v^<>^>^^<^^v^^><><<>>>>><v^v<^v^<<><<^>v<>^v>^<<v<^^v^v>v><<>v^>v>>v<^>v><^<^vv><^v<vvv>^>><>v<^>vv^^><vv<<v^>^<<>^>vv^<>^<vv>^>^><vvv<<v>^^v>v>v^v<v^v<>^^vv^^<v^^<^^^vv<>^^^<>^^v<>v>v>v><>^^>vv^v^^^^<^^<^^>v<>>^<>v<^>^vvv>^v>v>v<>v<vvv>^>^^vv>^<v>^v^<vvv<<^<>v<>v^v<<^<v><>^^>><v>vvv>><<<v>^<<><><vv<^<<^><v><v>vv^^>>v^<<>v^>^<><^<^^><^v><v^><v^<>>>^^>^<^^><^>^^>^v><^<v<>><v^>v><v<>v<<>v^>v^<<v><^^><v><^<v^^>^<<<>^^vv>>^>^<<v^^^>v>>>>^v<^^^vv>><v^v<v^v>>vv^>>v<>v^^^^<^v^<^><<<<>^>^>vvv^vv<<vv^^<^<^>^>>v><v<>>>vv<>vv<v<vv>v^^^><>^<<<^<v>><v<"""

TEST = """########
#..O.O.#
##@.O..#
#...O..#
#.#.O..#
#...O..#
#......#
########

<^^>>>vv<v>>v<<"""

TEST2 = """##########
#..O..O.O#
#......O.#
#.OO..O.O#
#..O@..O.#
#O#..O...#
#O..O..O.#
#.OO.O.OO#
#....O...#
##########

<vv>^<v^>v>^vv^v>v<>v^v<v<^vv<<<^><<><>>v<vvv<>^v^>^<<<><<v<<<v^vv^v>^
vvv<<^>^v^^><<>>><>^<<><^vv^^<>vvv<>><^^v>^>vv<>v<<<<v<^v>^<^^>>>^<v<v
><>vv>v^v^<>><>>>><^^>vv>v<^^^>>v^v^<^^>v^^>v^<^v>v<>>v^v^<v>v^^<^^vv<
<<v<^>>^^^^>>>v^<>vvv^><v<<<>^^^vv^<vvv>^>v<^^^^v<>^>vvvv><>>v^<<^^^^^
^><^><>>><>^^<<^^v>>><^<v>^<vv>>v>>>^v><>^v><<<<v>>v<v<v>vvv>^<><<>^><
^>><>^v<><^vvv<^^<><v<<<<<><^v<<<><<<^^<v<^^^><^>>^<v^><<<^>>^v<v^v<v^
>^>>^v>vv>^<<^v<>><<><<v<<v><>v<^vv<<<>^^v^>^^>>><<^v>>v^v><^^>>^<>vv^
<><^^>^^^<><vvvvv^v<v<<>^v<v>v<<^><<><<><<<^^<<<^<<>><<><^^^>^^<>^>v<>
^^>vv<^v^v<vv>^<><v<^v>^^^>>>^^vvv^>vvv<>>>^<^>>>>>^<<^v>^vvv<>^<><<v>
v^^>>><<^^<>>^v^<v^vv<>v^<<>^<^v^v><^<<<><<^<v><v<>vv>>v><v^<vv<>v^<<^"""


def part1(INPUT):
    map, directions = INPUT.split("\n\n")
    directions = directions.replace("\n", "")
    grid: list[list[str]] = [list(row) for row in map.split("\n")]

    # print("\n".join("".join(row) for row in grid))
    # print(directions)

    atx, aty = 0, 0
    for y, row in enumerate(grid):
        for x, letter in enumerate(row):
            if letter == "@":
                atx, aty = x, y

    for dir in directions:
        # print(dir, atx, aty)
        xo, yo = 0, 0  # offset
        if dir == "<":
            xo, yo = -1, 0
        if dir == "^":
            xo, yo = 0, -1
        if dir == ">":
            xo, yo = 1, 0
        if dir == "v":
            xo, yo = 0, 1

        sx, sy = atx + xo, aty + yo  # start
        ex, ey = sx, sy  # end
        while grid[ey][ex] != "#":
            if grid[ey][ex] == ".":
                # swap
                grid[sy][sx] = "@"
                grid[aty][atx] = "."
                atx, aty = sx, sy
                if (ex, ey) != (sx, sy):
                    grid[ey][ex] = "O"
                break
            ex, ey = ex + xo, ey + yo

    #     print("\n".join("".join(row) for row in grid))
    #     print()

    total = 0
    for y, row in enumerate(grid):
        for x, letter in enumerate(row):
            if letter == "O":
                total += x + 100 * y

    print(total)


def part2(INPUT):
    map, directions = INPUT.split("\n\n")
    directions = directions.replace("\n", "")

    atx, aty = 0, 0
    boxes: set[tuple[int, int]] = set()
    walls: set[tuple[int, int]] = set()

    for y, row in enumerate(map.split("\n")):
        for x, c in enumerate(row):
            if c == "#":
                walls.add((2 * x, y))
                walls.add((2 * x + 1, y))
            elif c == "O":
                boxes.add((2 * x, y))
            elif c == ".":
                pass
            elif c == "@":
                atx, aty = 2 * x, y

    def get(x: int, y: int) -> str:
        if (x, y) == (atx, aty):
            return "@"
        elif (x, y) in walls:
            return "#"
        elif (x, y) in boxes:
            return "["
        elif (x - 1, y) in boxes:
            return "]"
        else:
            return "."

    # def print_grid() -> None:
    #     for y in range(len(map.split("\n"))):
    #         for x in range(2 * len(map.split("\n")[0])):
    #             print(get(x, y), end="")
    #         print()
    #     print()

    for dir in directions:
        # print(dir, atx, aty)
        xo, yo = 0, 0  # offset
        if dir == "<":
            xo, yo = -1, 0
        if dir == "^":
            xo, yo = 0, -1
        if dir == ">":
            xo, yo = 1, 0
        if dir == "v":
            xo, yo = 0, 1

        x, y = atx + xo, aty + yo
        should_move = True
        visited: set[tuple[int, int]] = set()
        to_push: set[tuple[int, int]] = set([(x, y)])
        while to_push:
            x, y = to_push.pop()
            # collect visited boxes then move them at the end
            tile = get(x, y)
            if tile == "[":
                visited.add((x, y))
                to_push.add((x + xo, y + yo))
                if yo:
                    to_push.add((x + xo + 1, y + yo))
            elif tile == "]":
                visited.add((x - 1, y))
                if yo:
                    to_push.add((x + xo - 1, y + yo))
                to_push.add((x + xo, y + yo))
            elif tile == ".":
                continue
            elif tile == "#":
                should_move = False
                break

        if should_move:
            # move all visited
            to_add: set[tuple[int, int]] = set()
            for vx, vy in visited:
                boxes.remove((vx, vy))
                to_add.add((vx + xo, vy + yo))
            boxes |= to_add
            # move @
            atx, aty = atx + xo, aty + yo

    total = sum(x + 100 * y for x, y in boxes)
    print(total)


part1(INPUT)
part2(INPUT)

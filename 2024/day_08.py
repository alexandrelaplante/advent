INPUT = """................n................L..Y.............
........m.........................................
.............n.............................l......
...............T.m..e....M........................
...........T..y...........i.......L.....2.........
.....................e.....h.......Y........l.....
...................i......d.......................
...5..............T....o......i...................
......C.5...........m..p...o.........2....I.......
.......C.n...........d..............o....p........
..............e........dp.....M...................
..8.........w.N.....n.p.....F.....................
.......N.......m.....D....o.......................
........DU...........y.........I..................
..D..X......N.T....M..............................
...........D..............2c..hl.A....M...........
.5.w.8...............h6...........................
5.....P...............d.Y.y......FA......L........
........w.................h.......................
...................N..............................
.............B...............u.f..................
.........wX.......6...............................
..............XC..............Ax..................
.P.......8......................c........f........
...e....U.u.........s.........f............Y......
..........U..X.........2..........W.....f.........
........P.........................................
.........s.u......................S...............
.....U...................c.....F............H.....
.........BC..........6............................
...................s..7..A...S............3I......
........B.s...u............S...i........H.........
..O.........................c....W....S...........
..........................a..........3......IE....
0........P................F.......................
.............7.................W........3.........
......t.W............7........................E...
...O.....9............................E...........
.....a19..........................................
....t.......O..........x..........................
..................................b..............3
........1......................b..................
.......1....8...........x.........................
.......40.........................................
.....t...O.0...4...........................H......
.......0..............x.......b...................
..4.......a.B..............b...........6..........
.......t9..........17..................H..........
........................9.........................
...........a......................................"""

TEST = """............
........0...
.....0......
.......0....
....0.......
......A.....
............
............
........A...
.........A..
............
............"""

from collections import defaultdict
from itertools import combinations


def part1(INPUT):
    rows = INPUT.split("\n")
    num_rows = len(rows)
    num_cols = len(rows[0])

    frequencies = defaultdict(list)
    for i, row in enumerate(rows):
        for j, antenna in enumerate(row):
            if antenna != ".":
                frequencies[antenna].append((i, j))

    antinodes = set()
    for locations in frequencies.values():
        for l1, l2 in combinations(locations, 2):
            i_diff = abs(l1[0] - l2[0])
            j_diff = abs(l1[1] - l2[1])

            if l1[0] < l2[0]:
                i1 = l1[0] - i_diff
                i2 = l2[0] + i_diff
            else:
                i1 = l1[0] + i_diff
                i2 = l2[0] - i_diff

            if l1[1] < l2[1]:
                j1 = l1[1] - j_diff
                j2 = l2[1] + j_diff
            else:
                j1 = l1[1] + j_diff
                j2 = l2[1] - j_diff

            if 0 <= i1 < num_rows and 0 <= j1 < num_cols:
                antinodes.add((i1, j1))
            if 0 <= i2 < num_rows and 0 <= j2 < num_cols:
                antinodes.add((i2, j2))

    # for i, row in enumerate(rows):
    #     for j, antenna in enumerate(row):
    #         if antenna != ".":
    #             print(antenna, end="")
    #         elif (i, j) in antinodes:
    #             print("#", end="")
    #         else:
    #             print(".", end="")
    #     print()
    print(len(antinodes))


def part2(INPUT):
    rows = INPUT.split("\n")
    num_rows = len(rows)
    num_cols = len(rows[0])

    frequencies = defaultdict(list)
    for i, row in enumerate(rows):
        for j, antenna in enumerate(row):
            if antenna != ".":
                frequencies[antenna].append((i, j))

    antinodes = set()
    for locations in frequencies.values():
        for l1, l2 in combinations(locations, 2):
            i_diff = abs(l1[0] - l2[0])
            j_diff = abs(l1[1] - l2[1])

            for mult in range(0, 1000):
                if l1[0] < l2[0]:
                    i1 = l1[0] - i_diff * mult
                    i2 = l2[0] + i_diff * mult
                else:
                    i1 = l1[0] + i_diff * mult
                    i2 = l2[0] - i_diff * mult

                if l1[1] < l2[1]:
                    j1 = l1[1] - j_diff * mult
                    j2 = l2[1] + j_diff * mult
                else:
                    j1 = l1[1] + j_diff * mult
                    j2 = l2[1] - j_diff * mult

                if 0 <= i1 < num_rows and 0 <= j1 < num_cols:
                    antinodes.add((i1, j1))
                if 0 <= i2 < num_rows and 0 <= j2 < num_cols:
                    antinodes.add((i2, j2))

    print(len(antinodes))


part1(INPUT)
part2(INPUT)

test_data = """...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#....."""

data = """...........#...............................................#...................#.....#.............#........................................
..................#..................................#..................#.....................#................#...................#.......#
....#........................................................................................................................#..............
..............................#........#..................................................#.................................................
.............#........#...........................#..........................#..............................#...............................
......................................................................................................#.............#.......................
...........................................................#......................#........................................#................
.........#.....................................#.......................#..................................................................#.
..................#.......#....................................................................#...................................#........
#..........................................#...............................................................#......#.........................
..................................................#.........................................................................................
..............................................................#.....#....................#..................................................
......#..............................#......................................................................................................
...............................................#......#.................#..........#................................#.......................
..............................................................................#........................#.................................#..
.............#....................................................................................#............................#............
.......................#.............................................#......................................................................
...............................#....................#.........................................#.....................................#.......
..........#.................................................................................................#...............................
..........................................................................#.......#..........................................#..............
...#..............................#............................#....................................#..................#....................
..................#..........................#....................................................................................#.........
.........................#.........................#.......#..........#...................#.................................................
........#.....#.............................................................#...................#........#..................................
..............................#.........#......................................................................................#......#.....
......................................................#......................................................#..............................
....................................................................................................#.......................................
.............................................................#.......#.....................#.......................#...............#........
..#...................#......................................................................................................#..............
......................................#..........................#.....................#....................................................
.............#..............................................................................................................................
...............................#.................#.........................#...................#..............#.............................
........................#...........................................................#................................................#......
........................................#................................................#..........#......................................#
......................................................................#............................................#......#.................
............................................................................................................................................
...........#................................................#.................................#.............................................
.....................................#......#...............................................................................................
....#............#..................................................#.............#....................#..........................#.........
............................................................................................................................................
.......................#.....#...........#............................................................................#..................#..
.......#................................................#...............................#......#............................................
...................................#...........................#...........#....................................#...........................
#.............................................................................................................................#.............
...............................#...........................#......................#.......................#.................................
............#.............#..................#..............................................................................................
....................................................#...............#........#.........#...........................................#........
...............................................................................................................#......#...................#.
.......#.............#..............#.......................................................................................................
.............................................................................................................................#..............
............................................................................................................................................
.................#............#...............................#.......#......................#..........#...............#...................
........................#..........................................................#................................................#.......
.#.................................................#........................................................................................
...........#.................................#.....................................................#........................................
......................................#.....................................................................#......#........................
.......#............#...................................................#.............................................................#.....
...............#.....................................#........#...............#............................................#...............#
...................................................................#....................#...................................................
.................................................#..........................................................................................
..................#........................#..................................................#.......#...............#.....................
............................................................................................................................................
......#...........................#..............................#..........................................................#...............
...........................................................#.....................................................#..........................
...........................#........................#..............................................................................#......#.
...........#..............................................................#..................................#..............................
..........................................#.................................................................................................
...#..........................................................#.........................#.......................................#...........
........................................................#......................#..........................#..........................#......
.......................#.............................................#.............................#........................................
.......................................................................................................................#....................
......#......#....................#.........................................................................................................
...............................................................#............#......#.....#..............#..........#..........#.............
.#...............#.....................#......#.....#.......................................................................................
...................................................................#.........................#...........................................#..
............................................................................................................................................
...........................................#...........................#..............................#.....................................
......#....................................................#....................#..............................#....................#.......
......................#.......#....................#........................................................................................
............#.................................#................#...............................#....................#.......................
.......................................#.................................................................................................#..
............................................................................................................................................
...#.....................#.........................................#...................#....................#....................#..........
.................#..............#.....................................................................................................#.....
...........................................................................#....................#.................#.........................
.......#...................................................................................#................................................
............#..........#....................................................................................................................
......................................................................#.......#.............................................#...............
........................................................................................................#...................................
....#.........................................................#.............................................................................
..........#....................#....................#......................#..................#......................#......................
#...............#...................#.........#..........#...................................................#..............................
...................................................................................................................................#........
............................#.........................................................#.....................................................
..........................................#...................................#.............................................................
...#.................................................#.................................................................#.....#.............#
......................#............#................................#...............................#.............#..................#......
.........................................................................................................#..................................
............#.....................................#.......................#...............#...................#.............................
.#....................................#.....#....................................................................................#..........
........#........................................................#..........................................................................
...................#........#............................#.............................#..............................#.....................
..............................................................................................................................#.............
....................................................#..........................#............................................................
........................#.......................................................................#............#............................#.
..........................................#................................................................................#................
..................#..........................................#.........................................#..............................#.....
.............#...................................#..................#........................#..............................................
.............................#...........................#......................#..................#........................................
...................................#................................................................................#........#..............
......#.................................................................#..............#....................................................
.................#.........................................................................................#................................
............................................................................................................................................
...........................#...........#.........................................#...................#................#............#.....#..
.#..........................................................................................#...............................................
.....................#............................#.....#...................#....................................#..........................
.............................................#.................#......................#.....................................................
...................................#................................#.......................................................................
......................................................................................................#.....................................
......#.....#....................................................................................#.............................#.....#......
.......................#...................#........#......................................#................................................
.............................................................................................................#..............................
#................#..........#........#..........#.......#......#........................................................................#...
.....................................................................#.........#........#.....#......#.................#....................
................................#...........................................................................................................
.........................#..............#....................................................................................#..............
..........#.................................................................................................................................
..........................................................................................#........#........................................
.................#...................#..........#.......#......#...................................................#...............#........
............................................................................................................................................
.............................#................................................................#.............................................
...#.......#................................................................#........#...................#............#.........#..........#
........................#.................#................#................................................................................
.....................................................................#.....................................................#................
....................................................#............................#......................................................#...
.#..........................................................................................#......#...............#..............#.........
............................................................................................................................................
..........#........#............#.........................................................................#.................................
........................................................#..........#........................................................................
.....#.............................................#.........#....................#.............................#.........#................."""


from itertools import combinations


def expand(data: str) -> list[str]:
    rows = data.split("\n")

    # expand rows
    y = 0
    while y < len(rows):
        if all(c == "." for c in rows[y]):
            rows.insert(y, str(rows[y]))
            y += 1
        y += 1

    # expand columns
    x = 0
    while x < len(rows[0]):
        if all(rows[y][x] == "." for y in range(len(rows))):
            for y in range(len(rows)):
                rows[y] = rows[y][:x] + "." + rows[y][x:]
            x += 1
        x += 1

    return rows


def taxicab_distance(x1: int, y1: int, x2: int, y2: int) -> int:
    return abs(x1 - x2) + abs(y1 - y2)


def part1(data):
    print(data)

    expanded = expand(data)

    for row in expanded:
        print(row)

    galaxies = []
    for y, row in enumerate(expanded):
        for x, c in enumerate(row):
            if c == "#":
                galaxies.append((x, y))

    all_pairs = combinations(galaxies, 2)

    return sum(taxicab_distance(*g1, *g2) for g1, g2 in all_pairs)


class Galaxy:
    x: int
    y: int

    def __init__(self, x: int, y: int):
        self.x = x
        self.y = y
        self.original_x = x
        self.original_y = y


class Universe:
    data: str
    galaxies: list[Galaxy]

    def __init__(self, data: str) -> None:
        galaxies = []
        for y, row in enumerate(data.split("\n")):
            for x, c in enumerate(row):
                if c == "#":
                    galaxies.append(Galaxy(x=x, y=y))
        self.data = data
        self.galaxies = galaxies

    def expand(self, factor: int) -> None:
        rows = self.data.split("\n")

        # expand rows
        for y in range(len(rows)):
            if all(rows[y][x] == "." for x in range(len(rows[0]))):
                for galaxy in self.galaxies:
                    if galaxy.original_y >= y:
                        galaxy.y += factor - 1

        # expand columns
        for x in range(len(rows[0])):
            if all(rows[y][x] == "." for y in range(len(rows))):
                for galaxy in self.galaxies:
                    if galaxy.original_x >= x:
                        galaxy.x += factor - 1


def part2(data):
    universe = Universe(data=data)
    universe.expand(factor=1000000)

    all_pairs = combinations(universe.galaxies, 2)

    return sum(taxicab_distance(g1.x, g1.y, g2.x, g2.y) for g1, g2 in all_pairs)


print(part1(data))
print(part2(data))
